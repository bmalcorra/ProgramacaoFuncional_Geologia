---
title: "aula3 - visualização de dados usando ggplot"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r}
library(tidyverse)
library(readxl)
```



```{r}
setwd("C:/Users/barba/Desktop/ProgramacaoFuncional_Geologia/ProgramacaoFuncional_Geologia/")

dados.ex = read_excel("dados_santos2009.xlsx") %>% 
  rename(distance = `Distance from contact (m)`) %>% 
  mutate(distance = replace_na(distance, "0"),
         litho = case_when(Rock == c("sill", "Sill") ~ "volcanic",
                           Rock == "Black shale" ~ "shale",
                           TRUE ~ "carbonate")) %>% 
  separate(distance,
           into = c("lower", "upper"),
           sep = "–") %>% 
  relocate(litho, upper, lower, .before = Co) %>% 
  mutate(across(upper:Tm, as.double))

dados.ex
```


# Box plot

```{r}
dados.ex %>% 
  ggplot(aes(x = litho, y = Pb, fill = litho)) +
  geom_boxplot() +
  stat_summary(color = "red") + #calcula o erro padrão (SE)
  geom_jitter(alpha = 0.5, size = 3)
```


# Bar plot - error bars

```{r}
dados.ex %>% 
  pivot_longer(cols = Co:Tm,
               names_to = "variable",
               values_to = "value") %>% 
  ggplot(aes(x = litho, y = value, fill = litho)) +
  stat_summary(geom = "bar") +
  stat_summary() +
  facet_wrap(~variable, scales = "free")
```


# Scatter plot

```{r}
dados.ex %>% 
  ggplot(aes(x = lower, y = La/Eu, color = litho)) +
  geom_point(size = 3) + #aes aqui também
  geom_smooth(method = "lm", aes(color = litho)) +
  stat_cor(aes(label = paste(..r.label.., ..p.label.., sep = "~`,`~")),
           method = "spearman") +
  theme(legend.position = "right") +
  scale_x_log10() + #altera a escala
  labs(x = "distance to sill (m)")
```


```{r}
dados.ex %>% 
  ggplot(aes(x = lower, y = La/Tm)) +
  geom_point(size = 3) + #aes aqui também
  geom_smooth(method = "lm") +
  stat_cor(aes(label = paste(..r.label.., ..p.label.., sep = "~`,`~")),
           method = "spearman") +
  theme(legend.position = "right") +
  scale_x_log10() + #altera a escala
  labs(x = "distance to sill (m)")
```



# Histograma

Gráfico de distribuição de frequências

```{r}
dados.ex %>% 
  ggplot(aes(x = Pb)) +
  geom_histogram(color = "white")
```


# 


# Ajustes estéticos

```{r}
dados.ex %>% 
  pivot_longer(cols = Co:Tm,
               names_to = "variable",
               values_to = "value") %>% 
  ggplot(aes(x = litho, y = value, fill = litho)) +
  stat_summary(geom = "bar") +
  stat_summary() +
  facet_wrap(~variable, scales = "free") +
  labs(x = "Litho",
       y = "",
       title = "Título",
       subtitle = "Subtítulo",
       caption = "by ...",
       fill = "Litho") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle = element_text(hjust = 0.5, face = "italic"))
```


# Correlação

```{r}
library(corrplot)

dados.ex %>% 
  dplyr::select(lower, Co:Tm) %>% 
  cor() %>% 
  corrplot(method = "ellipse",
           type = "upper")
```


```{r}
library(GGally)

dados.ex %>% 
  dplyr::select(Co:Tm, lower) %>% 
  ggcorr()
```


```{r}
dados.ex %>% 
  dplyr::select(lower, Co:Tm) %>% 
  correlation::correlation()
```



# Tidypaleo

```{r}
library(tidypaleo)

dados.ex %>% 
  pivot_longer(cols = Co:Tm,
               names_to = "variable",
               values_to = "value") %>% 
  ggplot(aes(x = value, y = lower)) +
  geom_lineh() +
  geom_point(aes(color = variable),
             show.legend = FALSE) +
  scale_y_reverse() +
  facet_wrap(~variable, scales = "free") +
  labs(x = "",
       y = "Depth (metros)")
```



# Exercícios

Chumbo e Tório - explorando a relação

```{r}
dados.ex %>% 
  ggplot(aes(x = lower, y = Th)) +
  geom_point(alpha = 0.7, size = 2) +
  geom_smooth(method = "lm", se = TRUE) +
  labs(x = "distance to sill (m)",
       y = "Pb (ppm)",
       title = "Título",
       subtitle = "Subtítulo",
       caption = "referência") +
  facet_wrap(~litho, scales = "free")
```


- Faça um histograma da variável **last_eruption_year**

```{r}
volcano %>% 
  mutate(last_eruption_year = as.numeric(last_eruption_year)) %>% 
  ggplot(aes(last_eruption_year, fill = evidence_category)) +
  geom_histogram()
```




`r chunk_reveal("teste")`

```{r teste, warning=FALSE, message=FALSE}
volcano %>% 
  filter(country == "Antarctica") %>% 
  ggplot(aes(elevation, longitude, color = primary_volcano_type)) +
  geom_point()
```

